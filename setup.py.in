#!/usr/bin/env python
#
# $Id: setup.py 434 2005-11-04 15:02:07Z bas $
#
# set ts=4
#

import sys
import os

from distutils.core import setup, Extension 

# Try some usefule defaults if not set
#
PBS_LIB_DIR='@pbs_library_dir@'

if not PBS_LIB_DIR:
	print 'Please specify where the PBS libraries are!!'
	print 'edit setup.py and fill in the PBS_LIB_DIR variable'
	sys.exit(1)

# Test if we have all the libs:
#
LIBS = ['torque']

### Make symlinks to right torque version
#
VERSION = "@pbs_version@"
tmp = VERSION.split('.')
major_version = '.'.join( tmp[0:2] )


os.chdir('src')

## Always unlink previous links
#
try:
	os.unlink('pbs.py')
	os.unlink('pbs_wrap.c')
except OSError:
	pass

if major_version in [ '2.4' ]:
	os.symlink('pbs_wrap_2.4.c', 'pbs_wrap.c')
	os.symlink('pbs_2.4.py', 'pbs.py')
else:
	os.symlink('pbs_wrap_2.1.c', 'pbs_wrap.c')
	os.symlink('pbs_2.1.py', 'pbs.py')

os.chdir('..')

setup ( name = 'pbs_python',
	version = '4.0.0',
	description = 'openpbs/torque python interface',
	author = 'Bas van der Vlies',
	author_email = 'basv@sara.nl',
	url = 'http://subtrac.sara.nl/oss/pbs_python',


	extra_path = 'pbs',
		package_dir = { '' : 'src' }, 
		py_modules = [ 'pbs', 'PBSQuery' ], 

	ext_modules = [ 
		Extension( '_pbs', ['src/pbs_wrap.c'],
		library_dirs = [ PBS_LIB_DIR ],
		libraries = LIBS) 
	]
)
